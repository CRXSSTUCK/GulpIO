language: python
cache: pip

python:
  - "3.4"
  - "3.5"
  - "3.6"

before_install:
  - git fetch --unshallow || true

install:
  # get miniconda
  - wget -q https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
  - chmod +x miniconda.sh
  - ./miniconda.sh -b -p $PWD/anaconda
  - anaconda/bin/conda update --yes --quiet conda
  # install and extract ffmpg static binary to current directory
  - anaconda/bin/conda install --yes -c menpo ffmpeg=3.1.3
  - cp anaconda/bin/ffmpeg .
  - ./ffmpeg -version
  - export PATH=".:$PATH"

  - pip install -U pip setuptools
  - pip install --pre pybuilder
  - pyb -X install_dependencies

script:
  - pyb -X

deploy:
  provider: pypi
  user: twentybn-machine-user
  server: https://upload.pypi.org/legacy/
  distributions: sdist
  skip_cleanup: true
  password:
    secure: "aaCswp9CzmoQmdQlg34hWFgZCu6wF+BZjpvb0iN26DoOSFXvJUwXEIiOPljwQ7/NvpFibp2+167/pPXs5Bpt+FKK+3PfP46BiZIICBypTJEqzEMQFoFMd1fvYfcQ0w5insdmdOK5id3awTizk48iggLS19v8yUoGddFY2cNi+d0X+zO7bl7vrHFSvFJflan0wByBmlzhixsH6IISGcz1C7xR0Zwdo1iAs0tuSzLHcEb7zilzFjo0yUO1pfppB9kytlgx8K3nsD0+7YoAbNA1j5e7ytCEZVYKx66tPhOTikmXFuq7HonMJU8M+SR54tY9OgTS0SJfRMqT9ljNv4o3J+Jf7eyqpweMe/GukDbAM5RMKVJBwqQyNvC+OLtvXmA7/yoLRUDvMzPbMWq5Yz9s51w9CldoiXuuma2MYS8dEFj1AO3uU+79VpB2oniigTyM+kDfakw3oqlwjb1R7FoBNp3kdQ4/IUwW8oxYUd9EuQdrcsVtpFzkzyb3I5HgDm7NqiJAdyWyKWcGw8TWnN6Xa3iVObB4UWvOcqL/+rxyJ/z6hLenRcrmANbBs0g6HNVgTXn2LR+9nn5QRy7iJ9Qdbp2jZMwYuKZhWLSBDB0BphOHEVSs5iWQ8GnjwSxZIRj19hD+1t0c6EBshuvI+mADXYzGvivak2DS6onLRcBCpvs="
  on:
    repo: TwentyBN/GulpIO
    python: '3.6'
    branch: master
