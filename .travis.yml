language: python
cache: pip

python:
  - "3.4"
  - "3.5"
  - "3.6"

before_install:
  - git fetch --unshallow || true

install:
  # get miniconda
  - wget -q https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
  - chmod +x miniconda.sh
  - ./miniconda.sh -b -p $PWD/anaconda
  - anaconda/bin/conda update --yes --quiet conda
  # install and extract ffmpg static binary to current directory
  - anaconda/bin/conda install --yes -c menpo ffmpeg=3.1.3
  - cp anaconda/bin/ffmpeg .
  - ./ffmpeg -version
  - export PATH=".:$PATH"

  - pip install -U pip setuptools
  - pip install --pre pybuilder
  - pyb -X install_dependencies

script:
  - pyb -X

deploy:
  provider: pypi
  user: twentybn-machine-user
  server: https://upload.pypi.org/legacy/
  distributions: sdist
  skip_cleanup: true
  password:
    secure: "LOCyLnWFJzncGPzpkml34UcgUG5lPjcmA391IfeQpR2Qzif4EaP7uKx5xAnkmgv/mcWeDDVig19GI5XKNSEEgqVbIkS6UaTwXvF88/FsJcELxM0mCb3bqMgQ8OXChjuUFZ0RFFjC5fgu1n8avOZpl8oxRn2OUKYra9sN0W+oq3aNlmGhco3RbDVoJlF+iCfVIcO0GQSXiBXAnqc6GUPoGzEBYdcsltVxoYciwNQQCvkmFVqY/0RxL5qQ7OCq9T8+gopA3hFyo5A8LeC0Kw5/PpHXP38g8z/Pk/sF1FKAU11GCAktc81kNJ4DHLqHsb2bX8cjjOo/7eu6v+xMclOF68km364KFO+eAyXTmYTu6D6sNhrudGsAZIHbZ0hYKxaptGpiG41QBh53GKhA52cPrCLBRnFolXMqSp457qGHUbjSwFnCuw0KjvWNvxgKWkOFjo6hTFEEFFyudhZa1aqbbOKli8JmyyQ2H7sEFZvNgvbJlAge6MhNGTkncrjxdbrXHq34b7ChiuElEa04ivMZ78QlPSrF33LCkpBlV4gtQShMrc5FAh5fJiCfPA2qaoLicvodqRCUv362gMJTZnTlpZ1cqJzZnipQb6txex4n6ZAoD0Pd7mWW6OxTqCbcCOOomLK9YtDgRD8Lp+qWpWl4J4n/lPr1xg2euoyzyKa8yw4="
  on:
    repo: TwentyBN/GulpIO
    python: '3.6'
    branch: master
